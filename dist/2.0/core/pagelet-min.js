KISSY.add("brix/core/pagelet",function(a,b){function c(b){if(!b.attr("id")){var c;while(c=a.guid("brix_brick_")&&!a.one("#"+c))b.attr("id",c)}return b.attr("id")}var d=b.extend({initializer:function(){var a=this;a.isReady=!1,a.readyList=[],a.bricks=[],a.isAddBehavior=!1},bindUI:function(){var a=this,b=a.get("callback");b&&typeof b=="function"&&a.ready(b),a.get("autoBehavior")&&a.addBehavior()},getBrick:function(b){var c=this,d;return a.each(c.bricks,function(a){if(a.id===b)return d=a.brick,!1}),d||null},destroyBrick:function(a){var b=this;for(var c=0;c<b.bricks.length;c++){var d=b.bricks[c];if(a===d.id)return b._destroyBrick(d),b.bricks.splice(c,1),!1}},_destroyBrick:function(a){a.brick&&(a.brick.destroy&&a.brick.destroy(),a.brick=null)},addBehavior:function(){var a=this;if(a.get("rendered")&&!a.isAddBehavior){a.isAddBehavior=!0;var b=a.get("el"),c=b.all("[bx-name]");b.hasAttr("bx-name")&&(c=b.add(c)),a._addBehavior(c,function(b){a.bricks=b,a._fireReady(),a.on("beforeRefreshTmpl",function(b){b.node.all("[bx-name]").each(function(b){a.destroyBrick(b.attr("id"))})}),a.on("afterRefreshTmpl",function(b){a._addBehavior(b.node.all("[bx-name]"),function(b){b.length>0&&(a.bricks=a.bricks.concat(b))})})})}},_addBehavior:function(b,d){var e=this,f=[];b.each(function(a){var b=c(a),d=a.attr("bx-name"),e=a.attr("bx-path"),g=a.attr("bx-config");g=g?(new Function("return "+g))():{},f.push({id:b,name:d,path:e,config:g})});if(f.length>0){var g=[];a.each(f,function(b){b.path||(b.path="brix/gallery/"+b.name+"/"),a.inArray(g,b.path)||g.push(b.path)}),a.use(g.join(","),function(a){var b=arguments;a.each(f,function(c){var d=c.id,f=a.merge({container:"#"+d,el:"#"+d,pagelet:e},c.config),h=b[a.indexOf(c.path,g)+1],i=new h(f);c.brick=i}),b=null,d(f)})}else d(f)},ready:function(a){this.isReady?a.call(window,this):this.readyList.push(a)},_fireReady:function(){var a=this;if(a.isReady)return;a.isReady=!0;if(a.readyList){var b,c=0;while(b=a.readyList[c++])b.call(a);a.readyList=null}},destructor:function(){var b=this;a.each(b.bricks,function(a,c){b._destroyBrick(a)}),b.bricks=null;if(b.get("rendered")&&b.get("isRemoveHTML")){var c=b.get("el");b.get("isRemoveEl")?c.remove():c.empty(),c=null}}},{ATTRS:{autoBehavior:{value:!0},callback:{value:null}}});return d},{requires:["./chunk"]});